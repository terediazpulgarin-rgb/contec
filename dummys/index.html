<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no"/>
  <title>MENU</title>

  <!-- Preload imágenes -->
  <link rel="preload" as="image" href="Dummys/imagenes/Dummys.png">
  <link rel="preload" as="image" href="Dummys/imagenes/CONTEC.png">
   <link rel="preload" as="image" href="Dummys/imagenes/Dummys.png">

  <style>
    :root { color-scheme: light; }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; margin: 0; padding: 0; }
    html, body, img, a { -webkit-user-drag: none; }

    /* Clase dinámica para ocultar el cursor */
    .no-cursor, .no-cursor * {
      cursor: none !important;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #000;
      background-image: url('Dummys/imagenes/Dummys.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      height: 100dvh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      user-select: none;
      touch-action: manipulation;
    }

    .top-bar {
      position: absolute;
      top: 50px;
      left: 50px;
      right: 50px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }

    #boton4 { height: 200px; }
    .animation-apng { height: 400px; }

    .version {
      position: absolute;
      top: 260px;
      left: 50px;
      font-size: 30px;
      color: #fcf8f8;
      text-shadow: 0 2px 4px rgba(0,0,0,.5);
      font-weight: 700;
    }

    .botones-container {
      position: absolute;
      bottom: 100px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0 50px;
      box-sizing: border-box;
    }

    .boton {
      background: #e1dcdc;
      color: #333;
      border: none;
      text-align: center;
      cursor: pointer;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(0,0,0,.3);
      transition: .25s ease;
      font-weight: bold;
      text-decoration: none;
      font-size: 60px;
      width: 400px;
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 20px;
      box-sizing: border-box;
      line-height: 1.2;
    }
    .boton:hover { opacity:.9; transform: translateY(-4px); box-shadow: 0 10px 18px rgba(0,0,0,.35); }
    .boton:active { transform: translateY(0); }
    .boton.disabled {
      filter: grayscale(1);
      opacity: .55;
      cursor: not-allowed;
      box-shadow: 0 3px 8px rgba(0,0,0,.25);
      transform: none !important;
    }

    @media (max-width: 768px) {
      .top-bar { top:30px; left:30px; right:30px; flex-direction:column; align-items:center; gap:20px; }
      #boton4 { height:160px; }
      .animation-apng { height:300px; }
      .version { top:130px; left:30px; font-size:24px; }
      .botones-container { flex-direction:column; align-items:center; bottom:50px; padding:0; gap:20px; }
      .boton { width:90%; height:120px; font-size:40px; }
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <img id="boton4" src="Dummys/imagenes/CONTEC.png" alt="Logo CONTEC" draggable="false">
  </div>

  <div class="version">REV 1.0</div>

  <div class="botones-container">
    <a href="Dummys/menu-principal.html" class="boton" draggable="false">MENU<br>PRINCIPAL</a>
    <a id="btnPizarron" href="Dummys/pizarron.htm" class="boton disabled" draggable="false" aria-disabled="true"
       title="Carga estándares en el MENÚ para activar">
      PIZARRON
    </a>
  </div>

  <script>
    /* ========= Cursor oculto por defecto y alternable con C+R ========= */
    const CURSOR_KEY = "dummys_cursor_visible";
    function applyCursorState(visible){
      if(visible){ document.body.classList.remove("no-cursor"); }
      else{ document.body.classList.add("no-cursor"); }
      try{ localStorage.setItem(CURSOR_KEY, visible ? "1" : "0"); }catch(e){}
    }
    document.addEventListener("DOMContentLoaded", ()=>{ applyCursorState(false); }); // SIEMPRE oculto al iniciar

    const pressedKeys = new Set();
    window.addEventListener("keydown", (e)=>{
      pressedKeys.add(e.key.toLowerCase());
      if(pressedKeys.has("c") && pressedKeys.has("r")){
        const isVisible = !document.body.classList.contains("no-cursor");
        applyCursorState(!isVisible);
      }
    });
    window.addEventListener("keyup", (e)=>{ pressedKeys.delete(e.key.toLowerCase()); });

    /* ========= Pantalla completa persistente SIN mensaje ========= */
    const FS_FLAG = 'dummys_fs_intent';
    const docEl = document.documentElement;
    function isFS(){ return !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement); }
    function reqFS(){ const r = docEl.requestFullscreen || docEl.webkitRequestFullscreen || docEl.mozRequestFullScreen || docEl.msRequestFullscreen; if (r) return r.call(docEl).catch(()=>{}); }
    function tryEnterFSImmediate(){ reqFS(); }
    function markLeaving(){ try { sessionStorage.setItem(FS_FLAG, '1'); } catch(e){} }
    function autoFSInit(){
      if (sessionStorage.getItem(FS_FLAG) === '1' || /[?#&]fs=1\b/.test(location.href)) {
        tryEnterFSImmediate();
        try { sessionStorage.removeItem(FS_FLAG); } catch(e){}
      }
      const reenter = ()=>{ if (!isFS()) tryEnterFSImmediate(); };
      ['fullscreenchange','webkitfullscreenchange','mozfullscreenchange','MSFullscreenChange','visibilitychange']
        .forEach(evt => { document.addEventListener(evt, reenter); });
      window.addEventListener('pageshow', ()=>{ if (sessionStorage.getItem(FS_FLAG) === '1') { tryEnterFSImmediate(); try { sessionStorage.removeItem(FS_FLAG); } catch(e){} } });
      document.addEventListener('click', (e)=>{ const a = e.target.closest && e.target.closest('a[href]'); if (!a) return;
        const href = a.getAttribute('href'); if (!href || href.startsWith('javascript:') || href.startsWith('#')) return;
        markLeaving();
        try { const url = new URL(href, location.href); url.searchParams.set('fs','1'); a.setAttribute('href', url.toString()); } catch(_){}
      }, true);
    }
    document.addEventListener('DOMContentLoaded', autoFSInit);

    /* ========= Lógica Pizarrón ========= */
    const STORAGE_KEYS = ['dummys_rel_paths_master_v2','dummys_rel_paths_v4','dummys_rel_paths_v3','dummys_rel_paths_v2','dummys_rel_paths'];
    function normalizeRelPath(p){ p = String(p||'').trim().replace(/^["']+|["']+$/g,'').replace(/\\/g,'/'); const low = p.toLowerCase(); const i = low.lastIndexOf('dummys/'); if (i >= 0) { p = p.substring(i); if (p.startsWith('/')) p = p.slice(1); } return p; }
    function filenameNoExt(path){ const base = String(path).split('/').pop().toUpperCase(); return base.replace(/\.(HTML?|HTM|JPE?G|PNG)$/,''); }
    function readStoredAny(){ let merged = []; for (const k of STORAGE_KEYS) { try { const v = JSON.parse(localStorage.getItem(k) || '[]'); if (Array.isArray(v) && v.length) merged = merged.concat(v); } catch {} } return Array.from(new Set((merged || []).map(normalizeRelPath).filter(Boolean))); }
    function hayModelos(){ const rels = readStoredAny(); for (const rel of rels) { const base = filenameNoExt(rel); if (/^D[0-9O]{3,4}[A-Z]*\b/.test(base)) return true; if (/\bR\d+\s*[-_–—]\s*(AVI|POLI)\b/.test(base)) return true; } return false; }
    const btnPizarron = document.getElementById('btnPizarron');
    function refrescarEstadoPizarron(){ const activo = hayModelos(); if (activo) { btnPizarron.classList.remove('disabled'); btnPizarron.setAttribute('aria-disabled','false'); btnPizarron.title = 'Abrir Pizarrón'; } else { btnPizarron.classList.add('disabled'); btnPizarron.setAttribute('aria-disabled','true'); btnPizarron.title = 'Carga estándares en el MENÚ para activar'; } }
    btnPizarron.addEventListener('click', e => { if (btnPizarron.classList.contains('disabled')) { e.preventDefault(); if (navigator.vibrate) navigator.vibrate(30); } });
    document.addEventListener('DOMContentLoaded', ()=>{ refrescarEstadoPizarron(); });
    window.addEventListener('storage', (e)=>{ if(!e.key) return; if(e.key==='dummys_catalog_bump' || STORAGE_KEYS.includes(e.key)) refrescarEstadoPizarron(); });
    setInterval(refrescarEstadoPizarron, 1500);

    document.addEventListener('contextmenu', e=>e.preventDefault());
    document.addEventListener('selectstart', e=>e.preventDefault());
    document.addEventListener('dragstart',  e=>e.preventDefault());
    window.addEventListener('keydown', (e)=> {
      if ((e.ctrlKey||e.metaKey) && (['+','-','=','0'].includes(e.key))) e.preventDefault();
      if (['F11'].includes(e.key)) e.preventDefault();
    });
  </script>
</body>
</html>
